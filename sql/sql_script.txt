CREATE DATABASE IF NOT EXISTS CINEMA;

USE CINEMA;

DROP TABLE IF EXISTS TICKET;
DROP TABLE IF EXISTS PROJECTION;
DROP TABLE IF EXISTS SEAT;
DROP TABLE IF EXISTS STAGE;
DROP TABLE IF EXISTS CINEMA;
DROP TABLE IF EXISTS EMPLOYEE;
DROP TABLE IF EXISTS CINEMA_EMPLOYEE;
DROP TABLE IF EXISTS FILM;
DROP TABLE IF EXISTS SEAT_CATEGORY;

CREATE TABLE SEAT_CATEGORY(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(30) NOT NULL,
	DESCRIPTION VARCHAR(1000)
);

INSERT INTO SEAT_CATEGORY(NAME)
VALUES('REGULAR_SEAT');
INSERT INTO SEAT_CATEGORY(NAME, DESCRIPTION)
VALUES('LOVE_SEAT', 'DOUBLE SEAT WITHOUT SEPARATOR HANDREST');
INSERT INTO SEAT_CATEGORY(NAME, DESCRIPTION)
VALUES('RELAX_SEAT', 'SEAT WITH EXTENSION FOR RESTING LEGS');
INSERT INTO SEAT_CATEGORY(NAME, DESCRIPTION)
VALUES('VIP_SEAT', 'SEAT FOR VIP PERSON STATUS');

CREATE TABLE FILM(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(50) NOT NULL,
	DIRECTOR VARCHAR(100) NOT NULL,
	RATING ENUM('PG13', 'R', 'NC17'),
	GENRE ENUM('ACTION', 'HORROR', 'LOVE', 'ADVENTURE', 'THRILLER') NOT NULL,
	DURATION SMALLINT NOT NULL
);

INSERT INTO FILM(NAME, DIRECTOR, RATING, GENRE, DURATION)
VALUES('SPIDERMAN 3', 'SAM RAIMI', 'PG13', 'ACTION', 120);
INSERT INTO FILM(NAME, DIRECTOR, RATING, GENRE, DURATION)
VALUES('TITANIC', 'JAMES CAMERON', 'NC17', 'THRILLER', 180);
INSERT INTO FILM(NAME, DIRECTOR, RATING, GENRE, DURATION)
VALUES('BARBIE', 'GRETA M.', 'R', 'LOVE', 150);

CREATE TABLE EMPLOYEE(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	FIRSTNAME VARCHAR(25) NOT NULL,
	LASTNAME VARCHAR(25) NOT NULL,
	POSITION ENUM('CASHIER', 'MANAGER', 'CLEANER')
);

INSERT INTO EMPLOYEE(FIRSTNAME, LASTNAME, POSITION)
VALUES('Pero', 'Perić', 'CASHIER');
INSERT INTO EMPLOYEE(FIRSTNAME, LASTNAME, POSITION)
VALUES('Martina', 'Horvat', 'MANAGER');
INSERT INTO EMPLOYEE(FIRSTNAME, LASTNAME, POSITION)
VALUES('Ivo', 'Ivić', 'CLEANER');

CREATE TABLE CINEMA(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(30) NOT NULL,
	ADDRESS VARCHAR(100) NOT NULL
);

INSERT INTO CINEMA(NAME, ADDRESS)
VALUES('Cinema Branimirova', 'Branimirova 5 10000 Zagreb');
INSERT INTO CINEMA(NAME, ADDRESS)
VALUES('Cinema Avenue Mall', 'Avenija Većeslava Holjevca 10 10000 Zagreb');

CREATE TABLE CINEMA_EMPLOYEE(
	CINEMA_ID INT NOT NULL,
	EMPLOYEE_ID INT NOT NULL,
	PRIMARY KEY (CINEMA_ID, EMPLOYEE_ID)
);

INSERT INTO CINEMA_EMPLOYEE VALUES(1, 1);
INSERT INTO CINEMA_EMPLOYEE VALUES(1, 2);
INSERT INTO CINEMA_EMPLOYEE VALUES(2, 3);

CREATE TABLE STAGE(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(30) NOT NULL,
	DESCRIPTION VARCHAR(1000),
	CINEMA_ID INT NOT NULL,
	FOREIGN KEY(CINEMA_ID) REFERENCES CINEMA(ID)
);

INSERT INTO STAGE(NAME, CINEMA_ID)
VALUES('DVORANA_1', 1);
INSERT INTO STAGE(NAME, CINEMA_ID)
VALUES('DVORANA_2', 2);
INSERT INTO STAGE(NAME, CINEMA_ID)
VALUES('DVORANA_3', 1);

CREATE TABLE PROJECTION(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	FILM_ID INT NOT NULL,
	DATE_AND_TIME TIMESTAMP NOT NULL,
	STAGE_ID INT NOT NULL,
	FOREIGN KEY(FILM_ID) REFERENCES FILM(ID),
	FOREIGN KEY(STAGE_ID) REFERENCES STAGE(ID)
);

INSERT INTO PROJECTION(FILM_ID, DATE_AND_TIME, STAGE_ID)
VALUES(1, '2023-09-04 18:00:00', 1);
INSERT INTO PROJECTION(FILM_ID, DATE_AND_TIME, STAGE_ID)
VALUES(2, '2023-09-04 20:00:00', 2);
INSERT INTO PROJECTION(FILM_ID, DATE_AND_TIME, STAGE_ID)
VALUES(3, '2023-09-04 18:00:00', 3);

CREATE TABLE SEAT(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	ROW_NAME ENUM('A', 'B', 'C', 'D', 'E', 'F', 'G', 'H') NOT NULL,
	POSITION TINYINT UNSIGNED,
	CATEGORY_ID INT NOT NULL,
	STAGE_ID INT NOT NULL,
	FOREIGN KEY(CATEGORY_ID) REFERENCES SEAT_CATEGORY(ID),
	FOREIGN KEY(STAGE_ID) REFERENCES STAGE(ID)
);

INSERT INTO SEAT(ROW_NAME, POSITION, CATEGORY_ID, STAGE_ID)
VALUES('A', 1, (SELECT ID FROM SEAT_CATEGORY WHERE NAME = 'LOVE_SEAT'), 1);
INSERT INTO SEAT(ROW_NAME, POSITION, CATEGORY_ID, STAGE_ID)
VALUES('A', 2, (SELECT ID FROM SEAT_CATEGORY WHERE NAME = 'LOVE_SEAT'), 1);
INSERT INTO SEAT(ROW_NAME, POSITION, CATEGORY_ID, STAGE_ID)
VALUES('A', 3, (SELECT ID FROM SEAT_CATEGORY WHERE NAME = 'REGULAR_SEAT'), 2);
INSERT INTO SEAT(ROW_NAME, POSITION, CATEGORY_ID, STAGE_ID)
VALUES('A', 4, (SELECT ID FROM SEAT_CATEGORY WHERE NAME = 'VIP_SEAT'), 3);
INSERT INTO SEAT(ROW_NAME, POSITION, CATEGORY_ID, STAGE_ID)
VALUES('A', 5, (SELECT ID FROM SEAT_CATEGORY WHERE NAME = 'RELAX_SEAT'), 1);

CREATE TABLE TICKET(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	PROJECTION_ID INT NOT NULL,
	PURCHASE_TIMESTAMP TIMESTAMP NOT NULL,
	PRICE DECIMAL(6, 2) NOT NULL,
	SEAT_ID INT NOT NULL,
	FOREIGN KEY(PROJECTION_ID) REFERENCES PROJECTION(ID),
	FOREIGN KEY(SEAT_ID) REFERENCES SEAT(ID)
);

INSERT INTO TICKET(PROJECTION_ID, PURCHASE_TIMESTAMP, PRICE, SEAT_ID)
VALUES(1, '2023-09-04 11:47:00', 8.00, 1);
INSERT INTO TICKET(PROJECTION_ID, PURCHASE_TIMESTAMP, PRICE, SEAT_ID)
VALUES(2, '2023-09-04 11:48:00', 8.00, 2);
INSERT INTO TICKET(PROJECTION_ID, PURCHASE_TIMESTAMP, PRICE, SEAT_ID)
VALUES(1, '2023-09-04 11:49:00', 8.00, 3);
INSERT INTO TICKET(PROJECTION_ID, PURCHASE_TIMESTAMP, PRICE, SEAT_ID)
VALUES(2, '2023-09-04 11:50:00', 8.00, 4);